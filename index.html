<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Telepub Player</title>

<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: black;
    text-align: center;
    color: white;
  }

  #wink-player {
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
  }

  iframe {
    width: 100%;
    height: 360px;
    border: none;
  }

  .controls {
    margin-top: 10px;
  }

  button, a {
    padding: 12px 20px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    text-decoration: none;
    cursor: pointer;
  }

  .buy {
    background: #ff3b30;
    color: white;
  }

  .fullscreen {
    background: #333;
    color: white;
    margin-left: 10px;
  }

  /* fullscreen –ø–æ–≤–µ–¥–µ–Ω–∏–µ */
  #wink-player:fullscreen iframe {
    height: 100vh;
  }
</style>
</head>

<body>

<h3>Telepub ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä</h3>

<div id="wink-player"></div>

<div class="controls">
  <a class="buy"
     href="https://brand-sense.github.io/tma_traffic_test/?utm_source=telegram&utm_medium=miniapp&utm_campaign=test_tma&utm_content=btn1"
     target="_blank">
    –ö—É–ø–∏—Ç—å
  </a>

  <button class="fullscreen" onclick="openFullscreen()">‚õ∂ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å</button>
</div>

<script src="https://static-adtech.wink.ru/embed-sdk/winkembed.umd.js"></script>

<script>
  const container = document.getElementById("wink-player");

  const frame = WinkEmbedSDK.api.insertFrame(container, {
    trackId: 149613484,
    partnerId: 'P0',
    frameOptions: {
      width: "100%",
      height: "360px",
      allowFullscreen: true
    }
  });

  const { events } = WinkEmbedSDK;

  // =========================
  // üöÄ AUTO FULLSCREEN
  // =========================
  function openFullscreen() {
    if (container.requestFullscreen) {
      container.requestFullscreen();
    } else if (container.webkitRequestFullscreen) {
      container.webkitRequestFullscreen();
    }

    // –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç—å —ç–∫—Ä–∞–Ω
    if (screen.orientation && screen.orientation.lock) {
      screen.orientation.lock('landscape').catch(() => {});
    }
  }

  // –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ fullscreen –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–∏–¥–µ–æ
  frame.on(events.PLAYBACK_START, () => {
    console.log("‚ñ∂Ô∏è –í–∏–¥–µ–æ –Ω–∞—á–∞–ª–æ—Å—å");

    openFullscreen();
    sendEvent("playback_start");
  });

  // =========================
  // üìä –¢–†–ï–ö–ò–ù–ì (AdFox / –º–µ—Ç—Ä–∏–∫–∞)
  // =========================

  function sendEvent(name, data = {}) {
    console.log("TRACK:", name, data);

    // –ø—Ä–∏–º–µ—Ä ‚Äî –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ –º–µ—Ç—Ä–∏–∫—É
    if (window.ym) {
      ym(XXXXXX, 'reachGoal', name, data); // –≤—Å—Ç–∞–≤—å ID –º–µ—Ç—Ä–∏–∫–∏
    }

    // –∏–ª–∏ –ø–∏–∫—Å–µ–ª—å
    /*
    fetch(`https://your-tracker.com/event?e=${name}`);
    */
  }

  frame.on(events.AD_PLAYBACK, ({ ad_place_type, ad_position }) => {
    sendEvent("ad_impression", {
      type: ad_place_type,
      pos: ad_position
    });
  });

  frame.on(events.AD_END, ({ ad_place_type, ad_position }) => {
    sendEvent("ad_end", {
      type: ad_place_type,
      pos: ad_position
    });
  });

  frame.on(events.AD_SKIP, () => {
    sendEvent("ad_skip");
  });

  frame.on(events.AD_ERROR, () => {
    sendEvent("ad_error");
  });

  frame.on(events.PLAYBACK_END, () => {
    sendEvent("content_end");
  });

  // =========================
  // fallback ‚Äî –∫–ª–∏–∫ = fullscreen
  // =========================
  container.addEventListener("click", () => {
    openFullscreen();
  });

</script>

</body>
</html>
